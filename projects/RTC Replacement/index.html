<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>RTC Replacement for new PCB Revision | Joel Saunders</title> <meta name="author" content="Joel Saunders"> <meta name="description" content="Replacing a Real Time Clock and writing drivers for a new PCB Revision. Work Project"> <meta name="keywords" content="portfolio-website, Joel, Saunders, Engineer, Robotics, robots,"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://bloon1365.github.io/projects/RTC%20Replacement/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?6185d15ea1982787ad7f435576553d64"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Joel </span>Saunders</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">RTC Replacement for new PCB Revision</h1> <p class="post-description">Replacing a Real Time Clock and writing drivers for a new PCB Revision. Work Project</p> </header> <article> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <h2>Project Overview</h2> <p>This project involved updating legacy embedded firmware to support a new hardware revision after a critical component was discontinued. Specifically, a real-time clock (RTC) on the ProHeat product line was replaced with a newer, functionally equivalent device, requiring a new driver implementation and SPI interface updates on the microcontroller.</p> <p>The objective was to maintain product viability without rewriting large portions of an aging codebase, while ensuring future hardware revisions could be integrated with less friction.</p> <h2>Technical Scope</h2> <ol> <li> <strong>New RTC Driver Development:</strong><br> A complete driver was written for the replacement RTC, including initialization, register access, and timekeeping functionality. The implementation was designed to match the expectations of the existing firmware to minimize downstream changes.</li> <li> <strong>SPI Interface Integration:</strong><br> The microcontroller’s SPI configuration was updated to support the new device and the latest PCB revision. This included timing, mode selection, and data framing adjustments required for reliable communication.</li> <li> <strong>Legacy Codebase Integration:</strong><br> The driver was integrated into a large, aging codebase with limited abstraction and sparse documentation. Care was taken to avoid breaking existing functionality while introducing support for the new hardware revision.</li> </ol> <h2>Debugging &amp; Validation</h2> <ol> <li> <strong>Hardware-Level Debugging:</strong><br> Due to uncertainty around the SPI implementation, an oscilloscope was used as a sanity check to validate clock polarity, phase, chip select behavior, and data timing. This ensured the firmware behavior matched the RTC’s datasheet rather than relying solely on software assumptions.</li> <li> <strong>Dead-Bug Prototyping:</strong><br> Early validation was performed using a dead-bug setup with the new RTC manually wired into the existing board. This allowed driver bring-up and signal verification before finalized hardware was available.</li> </ol> <h2>Challenges</h2> <p> <strong>Legacy Firmware Constraints.</strong><br> The existing firmware was large, tightly coupled, and not designed with frequent hardware changes in mind. Limited abstraction and sparse documentation made driver integration difficult, as small changes could affect unrelated subsystems. Careful isolation and incremental validation were required to avoid regressions. </p> <p> <strong>Fine-Pitch Dead-Bug Rework.</strong><br> Before finalized hardware was available, the replacement RTC was dead-bugged and soldered under a microscope. Individual wires were attached to fine-pitch pads (approximately 0.5 mm pitch across a 16-pad package). The connections were fragile and frequently detached during adjustment and probing, making stable bring-up non-trivial. </p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure class="figure"> <figure> <picture> <img src="/assets/img/RTC%20Replacement/2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figcaption class="figure-caption"> Figure 1: Probed RTC </figcaption> </figure> </div> </div> <p> <strong>SPI Signal Verification.</strong><br> Due to both the legacy codebase and the fragile physical setup, updating the SPI interface was difficult. An oscilloscope was used to directly probe the SPI bus and confirm clock polarity, phase, chip-select behavior, and data validity. This step was critical in distinguishing firmware issues from physical connection failures and confirming successful communication with the RTC. </p> <p> Yellow is CS, Cyan is MISO, Purple is MOSI and Blue is Clk </p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure class="figure"> <figure> <picture> <img src="/assets/img/RTC%20Replacement/3.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figcaption class="figure-caption"> Figure 2: Dead-bug RTC with fine-pitch soldered leads (microscope view) </figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure class="figure"> <figure> <picture> <img src="/assets/img/RTC%20Replacement/5.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figcaption class="figure-caption"> Figure 3: SPI Request </figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure class="figure"> <figure> <picture> <img src="/assets/img/RTC%20Replacement/1.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figcaption class="figure-caption"> Figure 4: SPI Request and Receive </figcaption> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure class="figure"> <figure> <picture> <img src="/assets/img/RTC%20Replacement/6.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figcaption class="figure-caption"> Figure 5: RTC sending Hours, Minutes, Seconds, Day of Week, Day, Month and Yea </figcaption> </figure> </div> </div> <h2>Results &amp; Impact</h2> <p> The updated driver and SPI integration successfully enabled the new hardware revision, allowing the product to continue shipping despite component obsolescence. The work also established a clearer pattern for supporting future hardware changes, reducing the long-term maintenance burden. </p> <p> Without this update, the product would have been blocked by supply chain constraints. With it, the hardware transition became a contained firmware change rather than a full redesign. </p> <h2>Conclusion</h2> <p> This project demonstrated practical embedded development skills under real-world constraints: legacy code, minimal documentation, hardware uncertainty, and business-critical deadlines. By validating behavior at the signal level and carefully integrating new drivers, the system was extended without destabilizing existing functionality. </p> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © Copyright 2026 Joel Saunders. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?9b43d6e67ddc7c0855b1478ee4c48c2d" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>